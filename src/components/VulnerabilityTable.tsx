import { useState } from 'react'

import Vulnerability from '../components/Vulnerability'
import VulnerabilityDetails from '../components/VulnerabilityDetails'
import Modal from './Modal'

import { VulnerabilityTableProps, Vulnerability as VulnerabilityType } from '../types/vulnerability'

export default function VulnerabilityTable({vulnerabilities} : VulnerabilityTableProps ) {

  const [isModalOpen, setIsModalOpen] = useState<boolean>(false)
  const [selectedVulnerability, setSelectedVulnerability] = useState<VulnerabilityType | null>(null)

  function handleViewVulnerability(vuln: VulnerabilityType) {
    console.log("View button clicked")
    setSelectedVulnerability(vuln)
    setIsModalOpen(true)
  }

  function handleCloseModal() {
    setIsModalOpen(false);
    setSelectedVulnerability(null);
  }

  function handleResolveVulnerability() {
    console.log("Resolve button clicked")
  }

  return(
    <>
      <table>
        <thead>
          <tr>
            <th className="py-2">Severity</th>
            <th className="py-2">Name</th>
            <th className="py-2">Category</th>
            <th className="py-2">Description</th>
            <th className="py-2">Actions</th>
          </tr>
        </thead>
        <tbody>
        {vulnerabilities.map((vuln) => (
          <Vulnerability
            key={vuln.uuid}
            vulnerability={vuln}
            onView={() => handleViewVulnerability(vuln)}
            onResolve={handleResolveVulnerability}
          />
          ))}
        </tbody>
      </table>
      <Modal isOpen={isModalOpen} onClose={handleCloseModal} vulnerability={selectedVulnerability}/>
    </>
  )
}
